# WhooshAPI

Неофициальное API сервиса аренды самокатов Whoosh с интегрированным Telegram mini app.

<img src="https://github.com/mixelka75/WhooshAPI/blob/dev/exapmlesIMG/1.png" width="40%"><img src="https://github.com/mixelka75/WhooshAPI/blob/dev/exapmlesIMG/2.png" width="40%">

[Документация API](DocsAPI.md)

## Описание проекта

WhooshAPI представляет собой обертку вокруг официального API сервиса аренды электросамокатов Whoosh. Проект состоит из двух частей:
1. **FastAPI бэкенд** - обрабатывает запросы и транслирует их в официальное API Whoosh
2. **React Telegram mini app** - клиентское приложение для пользователей Telegram, позволяющее арендовать самокаты без установки официального приложения

   **На данный момент нет функционала брони в Mini App в API она есть**

Проект позволяет интегрировать сервисы аренды самокатов Whoosh в различные приложения, в частности, реализована интеграция с Telegram через Telegram Web App API.

## Архитектура

```
WhooshAPI/
├── .gitignore                    # Игнорируемые файлы Git
├── main.py                       # Основной файл FastAPI бэкенда
├── requirements.txt              # Зависимости Python
├── ids_regions.json              # Данные о регионах
├── whoosh_tokens.json            # Файл для хранения токенов авторизации
├── README.md                     # Документация проекта
└── whoosh-telegram-app/          # React приложение для Telegram
    ├── build/                    # Скомпилированные файлы React приложения
    ├── public/                   # Публичные файлы
    ├── src/                      # Исходный код React приложения
    ├── package.json              # Зависимости и скрипты npm
    └── ...
```

## Функциональность

### Бэкенд (FastAPI):
**!!Получение токена будет позже**

- Авторизация пользователей через токены Whoosh
- Автоматическое обновление токенов авторизации
- Проверка наличия пакетов минут
- Начало и завершение поездок на самокатах
- Получение информации о текущей поездке
- Бронирование самокатов
- Получение информации об аккаунте пользователя
- Управление платежными методами
- Просмотр подписок

### Фронтенд (React Telegram mini app):
- Интеграция с Telegram Web App API
- Адаптация под тему Telegram
- Начало и завершение поездки по коду самоката
- Отображение информации о текущей поездке
- Отображение информации о пакете минут
- Автоматическое обновление статуса поездки

## Установка и настройка

### Требования
- Python 3.7+
- Node.js и npm (для разработки React приложения)
- Доступ к API Whoosh

### Установка бэкенда
1. Клонируйте репозиторий
```bash
git clone https://github.com/yourusername/WhooshAPI.git
cd WhooshAPI
```

2. Установите зависимости Python
```bash
pip install -r requirements.txt
```

3. Настройте файл `whoosh_tokens.json` (вам потребуется получить refresh_token из официального приложения Whoosh)
```json
{
  "access_token": "",
  "id_token": "",
  "refresh_token": "ваш_рефреш_токен_здесь"
}
```

### Сборка React приложения (если требуются изменения)
1. Перейдите в каталог React приложения
```bash
cd whoosh-telegram-app
```

2. Установите зависимости
```bash
npm install
```

3. Соберите приложение
```bash
npm run build
```

### Запуск сервера
```bash
python main.py
```

Сервер будет доступен по адресу `http://localhost:8031`

## Настройка Telegram Bot и Mini App

1. Создайте бота в Telegram через [@BotFather](https://t.me/BotFather)
2. Настройте Web App URL для бота, указав адрес вашего развернутого API
3. Добавьте команду `/start` с настройкой на открытие вашего Web App

## API эндпоинты

### Проверка пакета минут
```
GET /api/minute_pack
```
Возвращает информацию о текущем пакете минут пользователя.

### Начало поездки
```
POST /api/start_trip
Content-Type: application/json

{
  "code": "ABCDEF"  // Код самоката
}
```
Начинает поездку на выбранном самокате по его коду.

### Информация о поездке
```
GET /api/trip_info
```
или
```
GET /api/trip_info?trip_id=your_trip_id
```
Возвращает информацию о текущей поездке.

### Завершение поездки
```
POST /api/end_trip
Content-Type: application/json

{
  "trip_id": "идентификатор_поездки"
}
```
Завершает текущую поездку.

### Обновление токенов вручную
```
POST /api/refresh_tokens
```
Обновляет токены авторизации вручную.

### Информация об аккаунте
```
GET /api/account
```
Возвращает информацию о текущем пользователе.

### Платежные методы
```
GET /api/payment_methods
```
Возвращает список платежных методов пользователя.

### Подписки пользователя
```
GET /api/subscriptions
```
Возвращает информацию о подписках пользователя.

### Доступные подписки
```
GET /api/subscription_offers
```
Возвращает информацию о доступных подписках для покупки.

### Бронирование самоката
```
POST /api/reserve_scooter/{scooter_code}
```
Бронирует самокат на 20 минут.

### Отмена бронирования
```
DELETE /api/cancel_reservation/{reservation_id}
```
Отменяет бронирование самоката.

### Начало поездки по бронированию
```
POST /api/start_reserved_trip
Content-Type: application/json

{
  "deviceCode": "ABCDEF"  // Код самоката
}
```
Начинает поездку по ранее забронированному самокату.

### Информация о текущих бронированиях
```
GET /api/active_reservations
```
Возвращает информацию о текущих бронированиях пользователя.

## Безопасность

Проект использует refresh_token для авторизации в API Whoosh. Токены хранятся в файле `whoosh_tokens.json`, который следует защитить от несанкционированного доступа.

## Отказ от ответственности

Это неофициальный проект, не связанный с компанией Whoosh. Используйте на свой страх и риск. Авторы не несут ответственности за любой ущерб, связанный с использованием данного API.
